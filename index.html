<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AKPsi Alumni Map</title>

  <!-- Mapbox GL CSS -->
  <link href="https://api.mapbox.com/mapbox-gl-js/v3.3.0/mapbox-gl.css" rel="stylesheet"/>

  <style>
    html, body { height: 100%; margin: 0; }
    #map { width: 100%; height: 100vh; }

    /* Popup layout + non-cropped logos */
    .mapboxgl-popup { max-width: 360px; }
    .mapboxgl-popup-content { padding: 16px 18px; }
    .popup-logo {
      display: block;
      margin: 0 auto 10px;
      max-width: 220px;
      height: auto;            /* keep full logo â€” no cropping */
      object-fit: contain;     /* letterbox inside the box */
      border-radius: 0;        /* ensure no circle mask */
    }
    .popup-title { font-weight: 700; font-size: 16px; color: #041E42; text-align:center; }
    .popup-line  { text-align:center; }
    .popup-muted { color:#666; font-size:12px; text-align:center; }
  </style>
</head>
<body>
  <div id="map"></div>

  <!-- Mapbox GL JS -->
  <script src="https://api.mapbox.com/mapbox-gl-js/v3.3.0/mapbox-gl.js"></script>
  <script>
    /* ===== Settings ===== */
    const MAPBOX_TOKEN = 'pk.eyJ1Ijoia3RyYW4yNCIsImEiOiJjbWhkaDBodW8wMzBnMnRwcnRrZjk1dHExIn0.Mx71kV2hMNjCtuuRLB37gw';
    const STYLE_URL    = 'mapbox://styles/ktran24/cmhdt73un001f01qvfzyndnek';
    /* If your geojson sits in the repo root next to this index.html, this relative path is best: */
    const GEOJSON_URL  = 'alumni.geojson';

    mapboxgl.accessToken = MAPBOX_TOKEN;

    const map = new mapboxgl.Map({
      container: 'map',
      style: STYLE_URL,
      center: [-30, 25],
      zoom: 1.3,
      projection: 'globe'
    });

    map.addControl(new mapboxgl.NavigationControl({ visualizePitch: true }), 'top-right');

    map.on('load', async () => {
      try {
        // Fetch your features
        const res  = await fetch(GEOJSON_URL, { cache: 'no-cache' });
        if (!res.ok) throw new Error('GeoJSON fetch failed: ' + res.status);
        const data = await res.json();

        // Add as a source
        map.addSource('alumni', { type: 'geojson', data });

        // Navy bubbles
        map.addLayer({
          id: 'alumni-bubbles',
          type: 'circle',
          source: 'alumni',
          paint: {
            'circle-radius': ['interpolate', ['linear'], ['zoom'], 1, 3, 6, 7, 10, 9],
            'circle-color': '#041E42',
            'circle-opacity': 0.9,
            'circle-stroke-color': '#FFFFFF',
            'circle-stroke-width': 1
          }
        });

        // Interactions
        map.on('mouseenter', 'alumni-bubbles', () => { map.getCanvas().style.cursor = 'pointer'; });
        map.on('mouseleave', 'alumni-bubbles', () => { map.getCanvas().style.cursor = ''; });

        map.on('click', 'alumni-bubbles', (e) => {
          const f = e.features[0];
          const p = f.properties || {};
          const imgHTML = p.Logo ? `<img class="popup-logo" src="${p.Logo}" alt="${p.Company || ''} logo">` : '';
          const cityCountry = [p.City, p.Country].filter(Boolean).join(', ');

          const html = `
            ${imgHTML}
            <div class="popup-title">${p.Name || ''}</div>
            <div class="popup-line">${p.Company || ''}</div>
            <div class="popup-muted">${cityCountry}</div>
            <div class="popup-muted" style="margin-top:6px;">${p.Industry || ''}</div>
          `;

          new mapboxgl.Popup({ offset: 12 })
            .setLngLat(f.geometry.coordinates)
            .setHTML(html)
            .addTo(map);
        });
      } catch (err) {
        console.error('Map init error:', err);
      }
    });
  </script>
</body>
</html>

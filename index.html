<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AKPsi Alumni Map — Minimal</title>
  <link href="https://api.mapbox.com/mapbox-gl-js/v3.3.0/mapbox-gl.css" rel="stylesheet" />
  <script src="https://api.mapbox.com/mapbox-gl-js/v3.3.0/mapbox-gl.js"></script>
  <style>
    html,body,#map { height:100%; margin:0 }
    #map, .mapboxgl-canvas { pointer-events:auto !important; }
    #dbg{position:fixed;left:8px;top:8px;background:#000a;color:#fff;padding:6px 8px;border-radius:6px;font:12px system-ui;z-index:9}
  </style>
</head>
<body>
  <div id="dbg">loading…</div>
  <div id="map"></div>

  <script>
    mapboxgl.accessToken = 'pk.eyJ1Ijoia3RyYW4yNCIsImEiOiJjbWhkaDBodW8wMzBnMnRwcnRrZjk1dHExIn0.Mx71kV2hMNjCtuuRLB37gw';
    const dbg = (m)=>document.getElementById('dbg').textContent=m;

    // ---- your data (inline) ----
    const ALUMNI = {
      "type":"FeatureCollection",
      "features":[
        {"type":"Feature","properties":{"Name":"Dev Pereira","Company":"EY","City":"Chicago","Country":"USA","Industry":"Consulting","Logo":"https://upload.wikimedia.org/wikipedia/commons/thumb/3/34/EY_logo_2019.svg/1200px-EY_logo_2019.svg.png"},"geometry":{"type":"Point","coordinates":[-87.623177,41.881832]}},
        {"type":"Feature","properties":{"Name":"Todd Amatayakul","Company":"McKinsey & Company","City":"Bangkok","Country":"Thailand","Industry":"Consulting","Logo":"https://cdn.cookielaw.org/logos/353d36fb-3a1c-4021-b831-ee6d50361d6a/07a8989e-cba1-4f60-a67a-0ffe9efc1b3a/5705935c-c99f-48d8-8aef-b78127f4aed3/mckinsey---company_owler_20190728_090718_original.png"},"geometry":{"type":"Point","coordinates":[100.523186,13.736717]}},
        {"type":"Feature","properties":{"Name":"Amaya Ghoshal","Company":"Goldman Sachs","City":"Boston","Country":"USA","Industry":"Finance","Logo":"https://1000logos.net/wp-content/uploads/2016/12/Goldman-Sachs-Logo.png"},"geometry":{"type":"Point","coordinates":[-71.0589,42.3601]}},
        {"type":"Feature","properties":{"Name":"Christina Chen","Company":"Experian","City":"New York City","Country":"USA","Industry":"Tech","Logo":"https://upload.wikimedia.org/wikipedia/commons/thumb/3/31/Experian_logo.svg/2560px-Experian_logo.svg.png"},"geometry":{"type":"Point","coordinates":[-74.006,40.7128]}}
      ]
    };

    // ---- map ----
    const map = new mapboxgl.Map({
      container:'map',
      style:'mapbox://styles/mapbox/streets-v12',   // stock style
      center:[-30,30],
      zoom:2.3,
      projection:'mercator'                         // reliable picking
    });
    map.addControl(new mapboxgl.NavigationControl(),'top-right');

    function popupHTML(p) {
  return `
    <div style="min-width:260px;max-width:300px;font-family:system-ui;text-align:center;">
      ${p.Logo ? `
        <div style="display:flex;justify-content:center;align-items:center;margin-bottom:10px;">
          <img src="${p.Logo}" alt="${p.Company || ''}"
               style="
                 max-width:170px; max-height:72px; width:auto; height:auto;
                 object-fit:contain;
                 background:#fff; padding:6px; border-radius:0 !important;
                 clip-path:none !important; -webkit-mask-image:none !important; mask-image:none !important;
               ">
        </div>
      ` : ''}
      <div style="font-weight:700;color:#041E42;font-size:15px;margin-bottom:2px;">
        ${p.Name || 'Unknown'}
      </div>
      <div style="font-size:14px;margin-bottom:2px;">${p.Company || ''}</div>
      <div style="color:#666;font-size:13px;margin-bottom:3px;">
        ${p.City || ''}${p.Country ? ', ' + p.Country : ''}
      </div>
      ${p.Industry ? `<div style="color:#999;font-size:12px;">${p.Industry}</div>` : ''}
    </div>
  `;
}
    // right after you create the popup, inject a tiny style reset
new mapboxgl.Popup({ offset: 12, maxWidth: '320px' })
  .setLngLat(f.geometry.coordinates)
  .setHTML(
    `<style>
       .mapboxgl-popup-content img { border-radius:0 !important; clip-path:none !important; -webkit-mask-image:none !important; mask-image:none !important; }
     </style>` + popupHTML(f.properties || {})
  )
  .addTo(map);
    
    map.on('load', () => {
      // source + layer
      map.addSource('alumni', { type:'geojson', data: ALUMNI });

      map.addLayer({
        id:'alumni-bubbles',
        type:'circle',
        source:'alumni',
        paint:{
          'circle-radius':['interpolate',['linear'],['zoom'], 0,8, 4,10, 8,12, 12,14],
          'circle-color':'#041E42',
          'circle-opacity':0.9,
          'circle-stroke-color':'#fff',
          'circle-stroke-width':2
        }
      });

      // ensure it's at very top
      map.moveLayer('alumni-bubbles');
      dbg(`features: ${ALUMNI.features.length}`);

      // hover cursor
      map.on('mousemove',(e)=>{
        const hits = map.queryRenderedFeatures(e.point,{layers:['alumni-bubbles']});
        map.getCanvas().style.cursor = hits.length ? 'pointer' : '';
      });

      // layer click
      map.on('click','alumni-bubbles',(e)=>{
        dbg('layer click');
        const f = e.features?.[0]; if(!f) return;
        new mapboxgl.Popup({offset:12,maxWidth:'320px'})
          .setLngLat(f.geometry.coordinates)
          .setHTML(popupHTML(f.properties||{}))
          .addTo(map);
      });

      // fallback hit-test anywhere
      map.on('click',(e)=>{
        const hits = map.queryRenderedFeatures(e.point,{layers:['alumni-bubbles']});
        dbg(`map click; hits: ${hits.length}`);
        if(hits.length){
          const f = hits[0];
          new mapboxgl.Popup({offset:12,maxWidth:'320px'})
            .setLngLat(f.geometry.coordinates)
            .setHTML(popupHTML(f.properties||{}))
            .addTo(map);
        }
      });
    });
  </script>
</body>
</html>
